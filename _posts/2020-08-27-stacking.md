---
title: "Ensemble Learning: Model Stacking"
date: 2020-08-27
tags: [machine learning, big data, pyspark]
header:
  image: "/images/michael-dziedzic-nbW-kaz2BlE-unsplash.jpg"
excerpt: "Text Classification using Model Stacking on Big Data"
mathjax: "true"
---

### Data

The dataset consists of sentences from customer reviews of different restaurants. There are 2241, 800, 800 customer reviews in the train, development, and test datasets, respectively. Our task is to identify the category of each customer review using the review text and the trained model.
The categories include:<br/>
* FOOD: reviews that involve comments on the food.
e.g. “All the appetizers and salads were fabulous , the steak was mouth watering and the pasta was delicious”
* PAS: reviews that only involve comments on price, ambience, or service.
e.g. “Now it 's so crowded and loud you ca n't even talk to the person next to you”
* MISC: reviews that do not belong to the above categories including sentences that are general recommendations reviews describing the reviewer’s personal experience or context, but that do not usually provide information on the restaurant quality
e.g. “Your friends will thank you for introducing them to this gem!”
e.g. “I knew upon visiting NYC that I wanted to try an original deli”

Firstly we import all the packages needed for data cleaning and model buidling. We utilise the Spark Eco-System that enables efficent manipulation of large data sets through the use of computing clustering and data parallelism.

```python
from pyspark.sql import *
from pyspark import SparkConf

from pyspark.sql import DataFrame
from pyspark.sql.functions import rand, udf
from pyspark.sql.types import IntegerType, DoubleType

from pyspark.ml import Pipeline, Transformer
from pyspark.ml.feature import OneHotEncoderEstimator, VectorAssembler
from pyspark.ml.classification import LogisticRegression, LinearSVC, NaiveBayes
from pyspark.ml.evaluation import MulticlassClassificationEvaluator
from pyspark.ml.feature import Tokenizer, CountVectorizer, StringIndexer
```
We can now import our data.
```python
# Create a Spark Session
conf = SparkConf().setMaster("local[*]").setAppName("lab3")
spark = SparkSession.builder.config(conf=conf).getOrCreate()

# Load data
train_data = spark.read.load("proj2train.csv", format="csv", sep="\t", inferSchema="true", header="true")
test_data = spark.read.load("proj2test.csv", format="csv", sep="\t", inferSchema="true", header="true")

train_data.show()
```

    +---+--------+--------------------+
    | id|category|            descript|
    +---+--------+--------------------+
    |  0|    MISC|I've been there t...|
    |  1|    FOOD|Stay away from th...|
    |  2|    FOOD|Wow over 100 beer...|
    |  3|    MISC|Having been a lon...|
    |  4|    MISC|This is a consist...|
    |  5|    FOOD|I ate here a week...|
    |  6|    MISC|First of all Dal ...|
    |  7|    FOOD|Great food at REA...|
    |  8|    FOOD|While there are p...|
    |  9|    MISC|My first encounte...|
    | 10|    FOOD|one of the best C...|
    | 11|     PAS|But the pizza is ...|
    | 12|    MISC|Turned out there ...|
    | 13|    FOOD|My entree of hot ...|
    | 14|    MISC|I will have to sa...|
    | 15|     PAS|The seats are unc...|
    | 16|    MISC|Please save yours...|
    | 17|    FOOD|The food is consi...|
    | 18|    MISC|--Eat Club is a r...|
    | 19|     PAS|Good atmosphere, ...|
    +---+--------+--------------------+
    only showing top 20 rows

### Base Model
